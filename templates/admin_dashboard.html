<!-- templates/admin_dashboard.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .container { max-width: 1000px; margin: 20px auto; padding: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
    th { background: #f0f0f0; }
    ul { margin: 0; padding-left: 20px; }
    form { margin: 0; }
  </style>
</head>
<body>
  

  <audio id="newOrderSound">
    <source src="/static/sound.mp3" type="audio/mpeg">
</audio>

  
  <div class="container">
    <h1>Admin Dashboard</h1>
    <p><a href="{{ url_for('admin_logout') }}">Logout</a></p>

    {% if orders %}
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Qty & Price</th>
            <th>Status</th>
            <th>Placed</th>
            <th>Location</th>
            <th>Update Status</th>
          </tr>
        </thead>
        <tbody>
          {% for o in orders %}
          <tr>
            <td>{{ o.order_id }}</td>
            <td>{{ o.customer_name }}<br>{{ o.phone }}<br>{{ o.email }}</td>
            <td>
              <ul>
                {% for item in o.items %}
                  <li>{{ item.item_name }}</li>
                {% endfor %}
              </ul>
            </td>
            <td>
              <ul>
                {% for item in o.items %}
                  <li>{{ item.quantity }} Ã— â‚¹{{ item.price }} = â‚¹{{ item.quantity * item.price }}</li>
                {% endfor %}
              </ul>
            </td>
            <td>{{ o.status }}</td>
            <td>{{ o.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
              {% if o.latitude and o.longitude %}
                <a href="https://www.google.com/maps?q={{ o.latitude }},{{ o.longitude }}" target="_blank">View Map</a>
              {% else %}
                N/A
              {% endif %}
            </td>
            <td>
              <form method="POST" action="{{ url_for('update_status', order_db_id=o.id) }}">
                <select name="status">
                  <option value="Pending" {% if o.status == 'Pending' %}selected{% endif %}>Pending</option>
                   <option value="Accepted" {% if o.status == 'Accepted' %}selected{% endif %}>Accepted</option>
                  <option value="Processing" {% if o.status == 'Processing' %}selected{% endif %}>Processing</option>
                   <option value="ontheway" {% if o.status == 'ontheway' %}selected{% endif %}>On the way</option>
                  <option value="Completed" {% if o.status == 'Completed' %}selected{% endif %}>Completed</option>
                  <option value="Cancelled" {% if o.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
                <button type="submit">Update</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No orders yet.</p>
    {% endif %}
  </div>


  
<script>
function checkOrders() {
    fetch('/check-new-orders')
        .then(response => response.json())
        .then(data => {
            if (data.new) {
                document.getElementById("newOrderSound").play();
                alert("ðŸ”” New Order Arrived!");
                location.reload();  // auto refresh page to show order
            }
        });
}

// check every 5 seconds
setInterval(checkOrders, 5000);
</script>
  
  
</body>
</html>
