<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Your Cart</title>

<style>
body { margin:0; font-family:'Poppins', sans-serif; background: linear-gradient(135deg, #4e54c8, #8f94fb); display:flex; justify-content:center; padding:20px; min-height:100vh; }
.cart-container { width:95%; max-width:500px; background: rgba(255,255,255,0.15); backdrop-filter: blur(12px); padding:25px; border-radius:20px; color:white; }
h1 { text-align:center; margin-bottom:20px; font-size:28px; font-weight:700; }
.cart-item { background: rgba(255,255,255,0.2); padding:12px; margin:10px 0; border-radius:12px; font-size:16px; display:flex; justify-content:space-between; font-weight:500; align-items:center; }
.remove-btn { background: rgba(255,0,0,0.6); border:none; border-radius:8px; padding:6px 10px; color:white; cursor:pointer; font-weight:600; }
.total-box { background: rgba(255,255,255,0.25); padding:12px; border-radius:12px; margin:15px 0; text-align:center; font-size:20px; font-weight:600; }
form input { width:100%; padding:12px; margin-top:10px; border-radius:12px; border:none; outline:none; font-size:15px; background: rgba(255,255,255,0.25); color:#fff; }
button { width:100%; padding:14px; margin-top:20px; border-radius:12px; background:#00e676; border:none; cursor:pointer; font-size:18px; font-weight:700; color:black; }
</style>
</head>

<body>

<div class="cart-container">
<h1>Your Cart</h1>

<div id="cart"></div>

<div class="total-box">Total: ₹<span id="total">0</span></div>

<form action="/place_order" method="POST" id="orderForm">

    <input type="text" name="name" placeholder="Full Name" required>
    <input type="email" name="email" placeholder="Email (optional)">
    <input type="text" name="phone" placeholder="Phone" required>
    <input type="text" name="address" placeholder="Address" required>

    <div id="cart-items-hidden"></div>

    <input type="hidden" name="latitude" id="latitude">
    <input type="hidden" name="longitude" id="longitude">

    <button id="submitBtn" type="submit">Place Order</button>
</form>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

function renderCart() {
    const cartDiv = document.getElementById("cart");
    const hiddenContainer = document.getElementById("cart-items-hidden");
    const totalEl = document.getElementById("total");

    cartDiv.innerHTML = "";
    hiddenContainer.innerHTML = "";
    let total = 0;

    if (cart.length === 0) {
        cartDiv.innerHTML = "<p>Your cart is empty.</p>";
        totalEl.textContent = "0";
        return;
    }

    cart.forEach((item, i) => {
        total += item.price * item.quantity;

        cartDiv.insertAdjacentHTML("beforeend", `
            <div class="cart-item">
                <span>${item.name} — ₹${item.price} × ${item.quantity}</span>
                <button type="button" class="remove-btn" onclick="removeItem(${i})">Remove</button>
            </div>
        `);

        // Hidden Inputs (CORRECT)
        hiddenContainer.insertAdjacentHTML("beforeend", `
            <input type="hidden" name="item_id[]" value="${item.id}">
            <input type="hidden" name="item_name[]" value="${item.name}">
            <input type="hidden" name="quantity[]" value="${item.quantity}">
            <input type="hidden" name="price[]" value="${item.price}">
        `);
    });

    totalEl.textContent = total;
}

function removeItem(i) {
    cart.splice(i, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
}

document.getElementById("orderForm").addEventListener("submit", function(event) {
    event.preventDefault();     // STOP double submitting
    document.getElementById("submitBtn").disabled = true;
    localStorage.removeItem("cart");
    this.submit();              // Submit only ONCE
});


function setLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            document.getElementById('latitude').value = pos.coords.latitude;
            document.getElementById('longitude').value = pos.coords.longitude;
        });
    }
}

window.onload = () => {
    renderCart();
    setLocation();
};
</script>

</body>
</html>
